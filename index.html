<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Binary Search Tree Insertion - Interactive Visualizer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .control-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .control-section {
            margin-bottom: 25px;
        }

        .control-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
        }

        .input-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f5f5f5;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .visualization-area {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            min-height: 600px;
        }

        #treeCanvas {
            width: 100%;
            height: 600px;
            border: 2px solid #f0f0f0;
            border-radius: 10px;
        }

        .steps-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-top: 20px;
        }

        .steps-panel h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .step {
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            background: #f8f9fa;
            border-left: 4px solid #e0e0e0;
            transition: all 0.3s;
        }

        .step.active {
            background: #e7f0ff;
            border-left-color: #667eea;
            transform: translateX(5px);
        }

        .step.completed {
            background: #d4edda;
            border-left-color: #28a745;
        }

        .level-order-output {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 2px solid #667eea;
        }

        .level-order-output h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .level-order-output pre {
            background: white;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 1.1em;
        }

        .examples {
            margin-top: 15px;
        }

        .example-btn {
            padding: 8px 15px;
            margin: 5px;
            background: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
        }

        .example-btn:hover {
            background: #e0e0e0;
        }

        .speed-control {
            margin-top: 15px;
        }

        .speed-control input[type="range"] {
            width: 100%;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸŒ³ Binary Search Tree Insertion</h1>
            <p>Interactive Visualization & Learning Tool</p>
        </div>

        <div class="main-content">
            <div class="control-panel">
                <div class="control-section">
                    <h3>Build Your Tree</h3>
                    <div class="input-group">
                        <label>Level Order Input (use -1 for null):</label>
                        <input type="text" id="treeInput" placeholder="e.g., 10 5 15 -1 -1 12 20" value="10 5 15 -1 -1 12 20">
                    </div>
                    <button class="btn btn-primary" onclick="buildTreeFromInput()">Build Tree</button>
                </div>

                <div class="control-section">
                    <h3>Insert Value</h3>
                    <div class="input-group">
                        <label>Value to Insert:</label>
                        <input type="number" id="insertValue" placeholder="e.g., 13" value="13">
                    </div>
                    <button class="btn btn-primary" id="insertBtn" onclick="startInsertion()">Start Insertion</button>
                    <button class="btn btn-secondary" id="nextStepBtn" onclick="nextStep()" disabled>Next Step</button>
                    <button class="btn btn-secondary" onclick="resetVisualization()">Reset</button>
                </div>

                <div class="control-section">
                    <h3>Animation Speed</h3>
                    <div class="speed-control">
                        <input type="range" id="speedSlider" min="500" max="3000" value="1500" step="100">
                        <div style="text-align: center; margin-top: 5px; color: #666;">
                            <span id="speedLabel">Normal</span>
                        </div>
                    </div>
                </div>

                <div class="control-section">
                    <h3>Quick Examples</h3>
                    <div class="examples">
                        <button class="example-btn" onclick="loadExample(1)">Example 1</button>
                        <button class="example-btn" onclick="loadExample(2)">Example 2</button>
                        <button class="example-btn" onclick="loadExample(3)">Example 3</button>
                    </div>
                </div>
            </div>

            <div class="visualization-area">
                <canvas id="treeCanvas"></canvas>
            </div>
        </div>

        <div class="steps-panel">
            <h3>Insertion Steps</h3>
            <div id="stepsContainer"></div>
            <div class="level-order-output" id="outputContainer" style="display: none;">
                <h4>Level Order Traversal Output:</h4>
                <pre id="levelOrderOutput"></pre>
            </div>
        </div>
    </div>

    <script>
        class TreeNode {
            constructor(val) {
                this.val = val;
                this.left = null;
                this.right = null;
                this.x = 0;
                this.y = 0;
            }
        }

        let root = null;
        let canvas, ctx;
        let insertionSteps = [];
        let currentStep = 0;
        let animationSpeed = 1500;
        let isAnimating = false;

        // Initialize canvas
        window.onload = function() {
            canvas = document.getElementById('treeCanvas');
            ctx = canvas.getContext('2d');
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            
            buildTreeFromInput();
            
            document.getElementById('speedSlider').addEventListener('input', function() {
                animationSpeed = parseInt(this.value);
                const speed = animationSpeed < 1000 ? 'Fast' : animationSpeed < 2000 ? 'Normal' : 'Slow';
                document.getElementById('speedLabel').textContent = speed;
            });
        };

        function buildTreeFromArray(arr) {
            if (arr.length === 0 || arr[0] === -1) return null;
            
            const root = new TreeNode(arr[0]);
            const queue = [root];
            let i = 1;
            
            while (queue.length > 0 && i < arr.length) {
                const node = queue.shift();
                
                if (i < arr.length && arr[i] !== -1) {
                    node.left = new TreeNode(arr[i]);
                    queue.push(node.left);
                }
                i++;
                
                if (i < arr.length && arr[i] !== -1) {
                    node.right = new TreeNode(arr[i]);
                    queue.push(node.right);
                }
                i++;
            }
            
            return root;
        }

        function buildTreeFromInput() {
            const input = document.getElementById('treeInput').value.trim();
            const arr = input.split(/\s+/).map(x => parseInt(x));
            root = buildTreeFromArray(arr);
            resetVisualization();
            drawTree();
        }

        function insertIntoBST(node, val, path = []) {
            if (node === null) {
                path.push({ action: 'insert', val: val });
                return new TreeNode(val);
            }
            
            path.push({ action: 'visit', node: node.val, val: val });
            
            if (val < node.val) {
                path.push({ action: 'goLeft', from: node.val });
                node.left = insertIntoBST(node.left, val, path);
            } else {
                path.push({ action: 'goRight', from: node.val });
                node.right = insertIntoBST(node.right, val, path);
            }
            
            return node;
        }

        function startInsertion() {
            const val = parseInt(document.getElementById('insertValue').value);
            if (isNaN(val)) {
                alert('Please enter a valid number');
                return;
            }
            
            insertionSteps = [];
            root = insertIntoBST(root, val, insertionSteps);
            currentStep = 0;
            displaySteps();
            
            document.getElementById('insertBtn').disabled = true;
            document.getElementById('nextStepBtn').disabled = false;
            
            animateSteps();
        }

        function displaySteps() {
            const container = document.getElementById('stepsContainer');
            container.innerHTML = '';
            
            insertionSteps.forEach((step, index) => {
                const div = document.createElement('div');
                div.className = 'step';
                div.id = `step-${index}`;
                
                if (step.action === 'visit') {
                    div.textContent = `Step ${index + 1}: Compare ${step.val} with ${step.node}`;
                } else if (step.action === 'goLeft') {
                    div.textContent = `Step ${index + 1}: ${step.val} < ${step.from}, go LEFT`;
                } else if (step.action === 'goRight') {
                    div.textContent = `Step ${index + 1}: ${step.val} >= ${step.from}, go RIGHT`;
                } else if (step.action === 'insert') {
                    div.textContent = `Step ${index + 1}: Insert ${step.val} here!`;
                }
                
                container.appendChild(div);
            });
        }

        function animateSteps() {
            if (currentStep >= insertionSteps.length) {
                showLevelOrderOutput();
                document.getElementById('nextStepBtn').disabled = true;
                document.getElementById('insertBtn').disabled = false;
                isAnimating = false;
                return;
            }
            
            isAnimating = true;
            highlightStep(currentStep);
            drawTree(insertionSteps[currentStep]);
            currentStep++;
            
            setTimeout(animateSteps, animationSpeed);
        }

        function nextStep() {
            if (currentStep >= insertionSteps.length) {
                showLevelOrderOutput();
                document.getElementById('nextStepBtn').disabled = true;
                document.getElementById('insertBtn').disabled = false;
                return;
            }
            
            highlightStep(currentStep);
            drawTree(insertionSteps[currentStep]);
            currentStep++;
        }

        function highlightStep(index) {
            document.querySelectorAll('.step').forEach((el, i) => {
                el.classList.remove('active', 'completed');
                if (i === index) {
                    el.classList.add('active');
                } else if (i < index) {
                    el.classList.add('completed');
                }
            });
        }

        function calculatePositions(node, x, y, horizontalSpacing) {
            if (!node) return;
            
            node.x = x;
            node.y = y;
            
            const spacing = horizontalSpacing / 2;
            
            if (node.left) {
                calculatePositions(node.left, x - spacing, y + 80, spacing);
            }
            if (node.right) {
                calculatePositions(node.right, x + spacing, y + 80, spacing);
            }
        }

        function drawTree(currentStep = null) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (!root) return;
            
            calculatePositions(root, canvas.width / 2, 50, canvas.width / 4);
            
            drawNode(root, currentStep);
        }

        function drawNode(node, currentStep) {
            if (!node) return;
            
            // Draw edges first
            if (node.left) {
                ctx.beginPath();
                ctx.moveTo(node.x, node.y);
                ctx.lineTo(node.left.x, node.left.y);
                ctx.strokeStyle = '#ccc';
                ctx.lineWidth = 2;
                ctx.stroke();
            }
            if (node.right) {
                ctx.beginPath();
                ctx.moveTo(node.x, node.y);
                ctx.lineTo(node.right.x, node.right.y);
                ctx.strokeStyle = '#ccc';
                ctx.lineWidth = 2;
                ctx.stroke();
            }
            
            // Draw child nodes
            if (node.left) drawNode(node.left, currentStep);
            if (node.right) drawNode(node.right, currentStep);
            
            // Draw current node
            let fillColor = 'white';
            let strokeColor = '#667eea';
            
            if (currentStep && currentStep.action === 'visit' && currentStep.node === node.val) {
                fillColor = '#fff3cd';
                strokeColor = '#ffc107';
            } else if (currentStep && currentStep.action === 'insert' && currentStep.val === node.val) {
                fillColor = '#d4edda';
                strokeColor = '#28a745';
            }
            
            ctx.beginPath();
            ctx.arc(node.x, node.y, 25, 0, 2 * Math.PI);
            ctx.fillStyle = fillColor;
            ctx.fill();
            ctx.strokeStyle = strokeColor;
            ctx.lineWidth = 3;
            ctx.stroke();
            
            ctx.fillStyle = '#333';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(node.val, node.x, node.y);
        }

        function getLevelOrder(root) {
            if (!root) return '';
            
            const result = [];
            const queue = [root];
            
            while (queue.length > 0) {
                const size = queue.length;
                let hasNonNull = false;
                
                for (let i = 0; i < size; i++) {
                    const node = queue.shift();
                    
                    if (node === null) {
                        result.push(-1);
                    } else {
                        result.push(node.val);
                        if (node.left || node.right) hasNonNull = true;
                        queue.push(node.left);
                        queue.push(node.right);
                    }
                }
                
                if (!hasNonNull) break;
            }
            
            // Find last non-null
            let last = result.length - 1;
            while (last >= 0 && result[last] === -1) {
                last--;
            }
            
            return result.slice(0, last + 1).join(' ');
        }

        function showLevelOrderOutput() {
            const output = getLevelOrder(root);
            document.getElementById('levelOrderOutput').textContent = output;
            document.getElementById('outputContainer').style.display = 'block';
        }

        function resetVisualization() {
            currentStep = 0;
            insertionSteps = [];
            document.getElementById('stepsContainer').innerHTML = '';
            document.getElementById('outputContainer').style.display = 'none';
            document.getElementById('insertBtn').disabled = false;
            document.getElementById('nextStepBtn').disabled = true;
            isAnimating = false;
            drawTree();
        }

        function loadExample(num) {
            if (num === 1) {
                document.getElementById('treeInput').value = '4 2 7 1 3';
                document.getElementById('insertValue').value = '5';
            } else if (num === 2) {
                document.getElementById('treeInput').value = '40 20 60 10 30 50 70';
                document.getElementById('insertValue').value = '25';
            } else if (num === 3) {
                document.getElementById('treeInput').value = '10 5 15 -1 -1 12 20';
                document.getElementById('insertValue').value = '13';
            }
            buildTreeFromInput();
        }

        window.addEventListener('resize', function() {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            drawTree();
        });
    </script>
</body>
</html>
